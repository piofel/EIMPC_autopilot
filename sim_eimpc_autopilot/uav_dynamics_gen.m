function xdot = uav_dynamics_gen(uavParameters,x,forces,moments)
    u = x(4);
    v = x(5);
    w = x(6);
    phi = x(7);
    theta = x(8);
    psi = x(9);
    p = x(10);
    q = x(11);
    r = x(12);
    sphi = sin(phi);
    cphi = cos(phi);
    ctheta = cos(theta);
    tntheta = tan(theta);
    R = rotation_matrix(phi,theta,psi);
    pdot = R'*[u;v;w];
    pndot = pdot(1);
    pedot = pdot(2);
    pddot = pdot(3);
    fx = forces(1);
    fy = forces(2);
    fz = forces(3);
    mass = uavParameters(10);
    udot = r*v - q*w + fx/mass;
    vdot = p*w - r*u + fy/mass;
    wdot = q*u - p*v + fz/mass;
    phidot = p + sphi*tntheta*q + cphi*tntheta*r;
    thetadot = cphi*q-sphi*r;
    psidot = sphi*q/ctheta + cphi*r/ctheta;
    Gamma1 = uavParameters(1);
    Gamma2 = uavParameters(2);
    Gamma3 = uavParameters(3);
    Gamma4 = uavParameters(4);
    Gamma5 = uavParameters(5);
    Gamma6 = uavParameters(6);
    Gamma7 = uavParameters(7);
    Gamma8 = uavParameters(8);
    Jy = uavParameters(12);
    pq = p*q;
    qr = q*r;
    ell = moments(1);
    m = moments(2);
    n = moments(3);
    pdot = Gamma1*pq - Gamma2*qr + Gamma3*ell + Gamma4*n;
    qdot = Gamma5*p*r - Gamma6*(p^2-r^2) + m/Jy;
    rdot = Gamma7*pq - Gamma1*qr + Gamma4*ell + Gamma8*n;
    xdot = [pndot pedot pddot udot vdot wdot phidot thetadot psidot pdot qdot rdot]';
end